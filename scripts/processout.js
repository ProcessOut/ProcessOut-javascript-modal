!function(){function e(e){this.message=e}var t="undefined"!=typeof exports?exports:self,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";e.prototype=new Error,e.prototype.name="InvalidCharacterError",t.btoa||(t.btoa=function(t){for(var i,o,r=String(t),a=0,s=n,c="";r.charAt(0|a)||(s="=",a%1);c+=s.charAt(63&i>>8-a%1*8)){if((o=r.charCodeAt(a+=.75))>255)throw new e("'btoa' failed: The string to be encoded contains characters outside of the Latin1 range.");i=i<<8|o}return c}),t.atob||(t.atob=function(t){var i=String(t).replace(/=+$/,"");if(i.length%4==1)throw new e("'atob' failed: The string to be decoded is not correctly encoded.");for(var o,r,a=0,s=0,c="";r=i.charAt(s++);~r&&(o=a%4?64*o+r:r,a++%4)?c+=String.fromCharCode(255&o>>(-2*a&6)):0)r=n.indexOf(r);return c})}(),"function"!=typeof Object.assign&&(Object.assign=function(e,t){"use strict";if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var n=Object(e),i=1;i<arguments.length;i++){var o=arguments[i];if(null!=o)for(var r in o)Object.prototype.hasOwnProperty.call(o,r)&&(n[r]=o[r])}return n}),[Element.prototype,CharacterData.prototype,DocumentType.prototype].forEach(function(e){e.hasOwnProperty("remove")||Object.defineProperty(e,"remove",{configurable:!0,enumerable:!0,writable:!0,value:function(){this.parentNode.removeChild(this)}})}),[].includes||(Array.prototype.includes=function(e){"use strict";var t=Object(this),n=parseInt(t.length)||0;if(0===n)return!1;var i,o,r=parseInt(arguments[1])||0;for(r>=0?i=r:(i=n+r)<0&&(i=0);i<n;){if(e===(o=t[i])||e!=e&&o!=o)return!0;i++}return!1});var ProcessOut,__extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();!function(e){!function(e){e[e.None=1]="None",e[e.OneOff=2]="OneOff",e[e.Subscription=3]="Subscription",e[e.Tokenization=4]="Tokenization"}(e.Flow||(e.Flow={}))}(ProcessOut||(ProcessOut={})),function(e){var t=function(){function t(t,n){this.instance=t,n.merchantCapabilities&&n.merchantCapabilities.length||(n.merchantCapabilities=["supports3DS"]),n.supportedNetworks&&n.supportedNetworks.length||(n.supportedNetworks=["amex","discover","masterCard","visa"]),this.request=n,this.session=new ApplePaySession(1,this.request);var i=this;this.session.onvalidatemerchant=function(t){i.instance.apiRequest("post",i.instance.endpoint("api","/applepay/sessions"),{session_url:t.validationURL,domain_name:window.location.hostname},function(t,n,o){t.success?i.session.completeMerchantValidation(t.session_payload):(i.onerror(new e.Exception(t.error_code,t.message)),i.session.abort())},function(t,n){i.onerror(new e.Exception("processout-js.network-issue")),i.session.abort()})},this.session.onpaymentauthorized=function(t){var n=i.data;n||(n={}),n.applepay_response=t.payment,n.token_type="applepay",i.instance.apiRequest("post",i.instance.endpoint("api","/cards"),n,function(t,n,o){t.success?i.onsuccess(t.card):(i.onerror(new e.Exception(t.error_code,t.message)),i.session.abort())},function(t,n){i.onerror(new e.Exception("processout-js.network-issue")),i.session.abort()})},this.session.oncancel=this.onCancelHandler.bind(this),this.session.onshippingcontactselected=this.onShippingContactSelectedHandler.bind(this),this.session.onshippingmethodselected=this.onShippingMethodSelectedHandler.bind(this)}return t.prototype.setHandlers=function(t,n){if(!t)throw new e.Exception("applepay.no-success-handler");this.onsuccess=t,this.onerror=function(e){n&&n(e)}},t.prototype.tokenize=function(e,t,n){this.setHandlers(t,n),this.session.begin()},t.prototype.abort=function(){this.session.abort()},t.prototype.completePayment=function(e){this.session.completePayment(e)},t.prototype.completePaymentMethodSelection=function(e,t){this.session.completePaymentMethodSelection(e,t)},t.prototype.completeShippingContactSelection=function(e,t,n,i){this.session.completeShippingContactSelection(e,t,n,i)},t.prototype.completeShippingMethodSelection=function(e,t,n){this.session.completeShippingMethodSelection(e,t,n)},t.prototype.getSession=function(){return this.session},t.prototype.onCancelHandler=function(e){this.oncancel&&this.oncancel(e)},t.prototype.onPaymentMethodSelectedHandler=function(e){this.onpaymentmethodselected&&this.onpaymentmethodselected(e)},t.prototype.onShippingContactSelectedHandler=function(e){this.onshippingcontactselected&&this.onshippingcontactselected(e)},t.prototype.onShippingMethodSelectedHandler=function(e){this.onshippingmethodselected&&this.onshippingmethodselected(e)},t}();e.ApplePay=t}(ProcessOut||(ProcessOut={})),function(e){var t=function(){function t(e){this.instance=e}return t.prototype.checkAvailability=function(t){window.ApplePaySession&&ApplePaySession.canMakePayments()?this.instance.apiRequest("get",this.instance.endpoint("api","/applepay/available"),{domain_name:window.location.hostname},function(n,i,o){n.success?t(null):t(new e.Exception("applepay.not-available",n.message))}.bind(this),function(n,i){t(new e.Exception("processout-js.network-issue"))}):t(new e.Exception("applepay.not-supported"))},t.prototype.newSession=function(t,n,i){return new e.ApplePay(this.instance,t)},t}();e.ApplePayWrapper=t}(ProcessOut||(ProcessOut={})),function(e){var t="processoutjs",n="true",i=function(){function i(i,o){if(this.instance=i,!o.source)throw new e.Exception("request.validation.error","Please provide a source to be used to start the 3-D Secure flow.");var r=o.url;if(!r&&o.invoiceID&&(r="/"+this.instance.getProjectID()+"/"+o.invoiceID+"/three-d-s/redirect/"+o.source+"?"+t+"="+n),!r&&(r="/"+this.instance.getProjectID()+"/three-d-s?"+t+"="+n+"&amount="+encodeURIComponent(o.amount)+"&currency="+encodeURIComponent(o.currency)+"&name="+encodeURIComponent(o.name)+"&return_url="+encodeURIComponent(o.returnURL?o.returnURL:"")+"&source="+encodeURIComponent(o.source),o.metadata&&"object"==typeof o.metadata))for(var a in o.metadata)o.metadata.hasOwnProperty(a)&&(r+="&metadata["+a+"]="+encodeURIComponent(o.metadata[a]));if(!r)throw new e.Exception("request.validation.error","Please provide a 3DS challenge URL or an invoice ID.");this.url=r}return i.prototype.handle=function(t,n){return this.instance.handleAction(this.instance.endpoint("checkout",this.url),function(e){t(e)},n,new e.ActionHandlerOptions(e.ActionHandlerOptions.ThreeDSChallengeFlow))},i}();e.ThreeDS=i}(ProcessOut||(ProcessOut={})),function(e){var t=function(){return function(){}}();e.ThreeDSOptions=t;var n=function(){function t(e){this.instance=e}return t.prototype.authenticate=function(t,n,i){return new e.ThreeDS(this.instance,t).handle(n,i)},t}();e.ThreeDSWrapper=n}(ProcessOut||(ProcessOut={})),function(e){var t=function(){function e(){}return e.prototype.token=function(){return"gway_req_"+btoa(JSON.stringify({gateway_configuration_id:this.gatewayConfigurationID,url:this.url,method:this.method,headers:this.headers,body:this.body,prepare:this.prepare}))},e}();e.GatewayRequest=t}(ProcessOut||(ProcessOut={})),function(e){var t=function(){return function(){}}();e.CardHolder=t;var n=function(){function t(e,n){this.month=e,this.year=t.parseYear(n)}return t.parse=function(e){var n=e.split(" / ");n.length<=1&&(n=e.split("/"));var i=Number(n[0]),o=0;return n.length>1&&(o=Number(n[1])),new t(i,o)},t.parseMonth=function(e){var t=Number(e);return t||(t=0),t},t.parseYear=function(e){var t=Number(e);return t||(t=0),t<2e3&&(t+=2e3),t},t.prototype.getMonth=function(){return this.month},t.prototype.getYear=function(){return this.year},t.prototype.string=function(){return this.month+" / "+this.year},t.prototype.validate=function(){var n=t.validateMonth(this.getMonth());if(n)return n;if(n=t.validateYear(this.getYear()))return n;var i=new Date;return this.getMonth()<i.getMonth()&&this.getYear()==i.getFullYear()?new e.Exception("card.invalid-date"):null},t.format=function(e){for(var t="",n=0;n<e.length;n++)-1!=="1234567890 /".indexOf(e[n])&&(t+=e[n]);return 2==t.length?t+" / ":4==t.length?t.slice(0,-3):t},t.validateMonth=function(t){return!t||t<1||t>12?new e.Exception("card.invalid-month"):null},t.validateYear=function(t){t<100&&(t+=2e3);var n=new Date;return!t||t<n.getFullYear()?new e.Exception("card.invalid-year"):null},t}();e.Expiry=n;var i=function(){function t(e,n,i){this.number=t.parseNumber(e),this.cvc=i,this.expiry=n}return t.prototype.getNumber=function(){return this.number},t.prototype.getExpiry=function(){return this.expiry},t.prototype.getCVC=function(){return this.cvc},t.luhn=function(e){for(var t=0,n=!1,i=e.length-1;i>=0;i--){var o=+e[i];n&&(o*=2)>9&&(o-=9),t+=o,n=!n}return t%10==0},t.prototype.validate=function(){var n=t.validateNumber(this.number);return n||(null==this.expiry?new e.Exception("card.invalid-date"):(n=this.expiry.validate())||t.validateCVC(this.cvc))},t.prototype.getIIN=function(){return t.getIIN(this.number)},t.prototype.getLast4Digits=function(){return t.getLast4Digits(this.number)},t.formatNumber=function(e){var n=t.getCardFormat(t.getIIN(e));e=t.parseNumber(e);for(var i="",o=0,r=0,a=0;a<e.length;a++)if(!isNaN(e[a])){if(r>=n[o]){if(r=0,++o>=n.length)break;i+=" "}i+=e[a],r++}return i},t.parseNumber=function(e){return String(e.replace(/ /gi,"").replace(/\-/gi,"").replace(/\-/gi,""))},t.validateNumber=function(n){return(n=t.parseNumber(n)).length<12?new e.Exception("card.invalid-number"):t.luhn(n)?null:new e.Exception("card.invalid-number")},t.validateCVC=function(t){return t&&t.length<3?new e.Exception("card.invalid-cvc"):null},t.getIIN=function(e){var n=(e=t.parseNumber(e)).length;return n>6&&(n=6),e.substring(0,n)},t.getLast4Digits=function(e){var n=(e=t.parseNumber(e)).length;return n>4&&(n=4),e.substr(e.length-n)},t.autoFormatNumber=function(e,n){var i=0;e.addEventListener("input",function(e){var o=this.selectionStart,r=this.value.length;this.value=t.formatNumber(this.value),o&&o<r&&(this.setSelectionRange(o,o),o>0&&" "==this.value[o-1]&&r>i&&this.setSelectionRange(o+1,o+1));var a=t.getPossibleCardLength(t.getIIN(this.value));n&&r>i&&t.parseNumber(this.value).length==a[1]&&n(),i=r})},t.autoFormatExpiry=function(e,t){var i=0;e.addEventListener("input",function(e){var o=this.selectionStart,r=this.value.length,a=n.format(this.value);a.length>7||(this.value=a,o&&o<r&&(this.setSelectionRange(o,o),o>0&&" "==this.value[o-1]&&r>i&&this.setSelectionRange(o+1,o+1)),t&&r>i&&7==this.value.length&&t(),i=r)})},t.getCardFormat=function(e){var n=t.getPossibleSchemes(e);return 1==n.length&&"american-express"==n[0]?[4,6,5]:[4,4,4,4,4]},t.getPossibleCardLength=function(e){for(var n=19,i=12,o=t.getPossibleSchemes(e),r=0;r<o.length;r++)switch(o[r]){case"visa":n=Math.min(n,13),i=Math.max(i,19);break;case"mastercard":case"instapayment":case"jcb":case"cardguard ead bg ils":case"elo":case"hipercard":n=Math.min(n,16),i=Math.max(i,16);break;case"american-express":case"uatp":n=Math.min(n,15),i=Math.max(i,15);break;case"diners-club":n=Math.min(n,14),i=Math.max(i,16);break;case"union-pay":case"discover":case"interpayment":case"dankort":case"naranja":case"cabal":case"argencard":n=Math.min(n,16),i=Math.max(i,19);break;case"maestro":n=Math.min(n,12),i=Math.max(i,19)}return n>i&&(n=12,i=19),[n,i]},t.getPossibleSchemes=function(e){e=t.parseNumber(e);var n={visa:["4"],mastercard:["22","23","24","25","26","27","51","52","53","54","55"],"american-express":["34","37"],"union-pay":["62"],"diners-club":["300","301","302","303","304","305","309","36","38","39"],discover:["6011","62","64","65"],jcb:["35"],maestro:["50","56","57","58","59","6"],dankort:["5019","4175","4571"],uatp:["1"],"cardguard ead bg ils":["5392"],hipercard:["606282"],elo:["401178","401179","438935","451416","457632","457393","431274","438935","457631","457632","506699","50670","50671","50672","50673","50674","50675","50676","506770","506771","506772","506773","506774","506775","506776","506777","506778","504175","509","627780","636297","636368","651652","651653","651654","651655","651656","651657","651658","651659","65166","65167","650031","650032","650033","650035","650036","650037","650038","650039","65004","650050","650051","65500","65501","650485","650486","650487","650488","650489","65049","65050","65051","65052","650530","650531","650532","650533","650534","650535","650536","650537","650538","650541","650542","650543","650544","650545","650546","650547","650548","650549","65055","65056","65057","65058","650590","650591","650592","650593","650594","650595","650596","650597","650598","65070","650710","650711","650712","650713","650714","650715","650716","650717","650718","650720","650721","650722","650723","650724","650725","650726","650727","655021","655022","655023","655024","655025","655026","655027","655028","655029","65503","65504","655050","655051","655052","655053","655054","655055","655056","655057","655058","650901","650902","650903","650904","650905","650906","650907","650908","650909","65091","65092","65093","65094","65095","65096","650970","650971","650972","650973","650974","650975","650976","650977","650978","650405","650406","650407","650408","650409","65041","65042","65043"],naranja:["377798","377799","402917","402918","527571","527572","589562"],cabal:["589657","600691","603522","6042","6043","636908"],argencard:["501105"],"carte bancaire":["45566","45611","47427","49702","41717","44245","48362","43953","45330","44244","45625","45626","44853","41509","46609","41506","45622","45939","46969","45056","45620","45930","41507","42012","43787","44995","44996","46547","46980","40221","40657","45616","45940","46657","47717","41505","43950","44841","45333","45621","45617","45624","46896","40100","44855","45627","45720","40594","43472","45567","45623","45721","42011","47802","45568","46703","47480","49703","45614","45629","46978","40355","41628","45331","45339","46361","40220","40223","43783","45615","46982","46986","47726","45054","45628","45932","45958","46321","47260","41503","41993","45929","45933","45937","43951","47718","47961","46625","47722","48373","40209","45613","45771","47268","48369","45618","45619","45954","47809","42346","43782","45332","45950","47729","45334","45335","45560","45612","40593","48160","48651","45051","45610","45745","45337"]},i=new Array;for(var o in n){var r=n[o];for(var a in r){var s=r[a],c=e.length>s.length?s.length:e.length;if(e.substring(0,c)==s.toString().substring(0,c)){i.push(o);break}}}return i},t}();e.Card=i}(ProcessOut||(ProcessOut={})),function(e){var t=function(){return function(){this.number=null,this.expiryMonth=null,this.expiryYear=null,this.cvc=null,this.name=null,this.metadata=null}}();e.CardFieldValue=t;var n=function(){function e(e){this.type=e}return e.prototype.apply=function(e){return e.placeholder&&(this.placeholder=e.placeholder),e.style&&(this.style=e.style),this},e}();e.CardFieldOptions=n;var i=function(){return function(){}}();e.CardFieldStyle=i;var o=function(){function t(n,i,o,r,a,s){if(this.handlers={},!o||!o.type)throw new e.Exception("processout-js.invalid-field-type","Options and a the field type must be provided to setup the field.");if(!r)throw new e.Exception("processout-js.undefined-field","The card field for the "+o.type+" does not exist in the given container.");if(r instanceof HTMLInputElement)throw new e.Exception("processout-js.invalid-field","The card field for the "+o.type+" must be an input field.");if(o.type!=t.number&&o.type!=t.expiry&&o.type!=t.expiryMonth&&o.type!=t.expiryYear&&o.type!=t.cvc)throw new e.Exception("processout-js.invalid-field-type");this.instance=n,this.form=i,this.options=o,this.el=r;var c=this.el.getAttribute("data-processout-placeholder");c&&(this.options.placeholder=c),this.spawn(a,s)}return t.prototype.spawn=function(n,i){var o=Math.random().toString(36).substring(7);this.uid="#"+o;var r=this.instance.getProcessOutFieldEndpoint("?r="+o+this.uid);this.iframe=document.createElement("iframe"),this.iframe.className="processout-field-cc-iframe",this.iframe.name=o,this.iframe.setAttribute("src",r),this.iframe.setAttribute("style","background: none; width: 100%;"),this.iframe.setAttribute("frameborder","0"),this.iframe.setAttribute("allowtransparency","1"),this.iframe.style.display="none",this.iframe.height="14px";var a=!1,s=setTimeout(function(){a=!0,typeof i==typeof Function&&i(new e.Exception("processout-js.field.unavailable"))},t.timeout);this.iframe.onload=function(){try{this.iframe.src=r}catch(e){}}.bind(this),window.addEventListener("message",function(t){if(!a){var i=e.Message.parseEvent(t);i.frameID==this.uid&&i.namespace==e.Message.fieldNamespace&&(this.handlEvent(i),"alive"==i.action&&this.iframe.contentWindow.postMessage(JSON.stringify({namespace:e.Message.fieldNamespace,projectID:this.instance.getProjectID(),action:"setup",formID:this.form.getUID(),data:this.options}),"*"),"ready"==i.action&&(this.iframe.style.display="block",clearTimeout(s),n(),this.iframe.contentWindow.postMessage(JSON.stringify({namespace:e.Message.fieldNamespace,projectID:this.instance.getProjectID(),action:"resize"}),"*"),this.iframe.addEventListener("focus",function(e){this.focus()}.bind(this))))}}.bind(this)),this.el.appendChild(this.iframe)},t.prototype.handlEvent=function(e){var t={field:this,type:this.options.type,element:this.el,data:e.data};switch(e.action){case"inputEvent":this.eventCallback&&this.eventCallback("oninput",t);break;case"mouseEnterEvent":this.eventCallback&&this.eventCallback("onmouseenter",t);break;case"mouseLeaveEvent":this.eventCallback&&this.eventCallback("onmouseleave",t);break;case"focusEvent":this.el.className=this.el.className+" processout-input-focused",this.eventCallback&&this.eventCallback("onfocus",t);break;case"blurEvent":this.el.className=this.el.className.replace(/\bprocessout-input-focused\b/g,"").replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),this.eventCallback&&this.eventCallback("onblur",t);break;case"next":this.next&&this.next();break;case"event":if(e.data.name in this.handlers)for(var n=this.handlers[e.data.name],i=0;i<n.length;i++)n[0](e.data.data);break;case"resize":this.iframe.height=e.data}},t.prototype.setNext=function(e){this.next=e},t.prototype.update=function(t){t.placeholder&&(this.options.placeholder=t.placeholder),t.style&&(this.options.style=Object.assign(this.options.style,t.style)),this.iframe.contentWindow.postMessage(JSON.stringify({namespace:e.Message.fieldNamespace,projectID:this.instance.getProjectID(),action:"update",data:this.options}),"*")},t.prototype.addEventListener=function(t,n){t in this.handlers||(this.handlers[t]=[]),this.handlers[t].push(n),this.iframe.contentWindow.postMessage(JSON.stringify({namespace:e.Message.fieldNamespace,projectID:this.instance.getProjectID(),action:"registerEvent",data:t}),"*")},t.prototype.on=function(e,t){return this.addEventListener(e,t)},t.prototype.blur=function(){this.iframe.contentWindow.postMessage(JSON.stringify({messageID:Math.random().toString(),namespace:e.Message.fieldNamespace,projectID:this.instance.getProjectID(),action:"blur"}),"*")},t.prototype.focus=function(){this.iframe.contentWindow.postMessage(JSON.stringify({messageID:Math.random().toString(),namespace:e.Message.fieldNamespace,projectID:this.instance.getProjectID(),action:"focus"}),"*")},t.prototype.validate=function(n,i){var o=Math.random().toString();this.iframe.contentWindow.postMessage(JSON.stringify({messageID:o,namespace:e.Message.fieldNamespace,projectID:this.instance.getProjectID(),action:"validate"}),"*");var r=setTimeout(function(){i(new e.Exception("processout-js.field.unavailable"))},t.timeout);window.addEventListener("message",function(t){var a=e.Message.parseEvent(t);a.frameID==this.uid&&a.namespace==e.Message.fieldNamespace&&a.messageID==o&&"validate"==a.action&&(clearTimeout(r),a.data?i(new e.Exception(a.data)):n())}.bind(this))},t.prototype.tokenize=function(n,i,o,r){var a=Math.random().toString();this.iframe.contentWindow.postMessage(JSON.stringify({messageID:a,namespace:e.Message.fieldNamespace,projectID:this.instance.getProjectID(),action:"tokenize",data:{fields:n,data:i}}),"*");var s=setTimeout(function(){r(new e.Exception("processout-js.field.unavailable"))},t.timeout);window.addEventListener("message",function(t){var n=e.Message.parseEvent(t);n.messageID==a&&"tokenize"==n.action&&(clearTimeout(s),n.data.token?o(n.data.token):n.data.error?r(new e.Exception(n.data.error.code,n.data.error.message)):r(new e.Exception("default")))}.bind(this))},t.prototype.refreshCVC=function(n,i,o){var r=Math.random().toString();this.iframe.contentWindow.postMessage(JSON.stringify({messageID:r,namespace:e.Message.fieldNamespace,projectID:this.instance.getProjectID(),action:"refresh-cvc",data:n}),"*");var a=setTimeout(function(){o(new e.Exception("processout-js.field.unavailable"))},t.timeout);window.addEventListener("message",function(t){var n=e.Message.parseEvent(t);n.messageID==r&&"refresh-cvc"==n.action&&(clearTimeout(a),n.data.token?i(n.data.token):n.data.error?o(new e.Exception(n.data.error.code,n.data.error.message)):o(new e.Exception("default")))}.bind(this))},t.number="number",t.expiry="expiry",t.expiryMonth="expiry-month",t.expiryYear="expiry-year",t.cvc="cvc",t.timeout=2e4,t}();e.CardField=o}(ProcessOut||(ProcessOut={})),function(e){var t=function(){function t(e,t){this.instance=e,this.element=t,this.uid=Math.random().toString()}return t.prototype.getUID=function(){return this.uid},t.prototype.setup=function(t,n,i){var o=!1,r=!1,a=!1,s=!1,c=function(){if(o&&r&&a&&s)return this.number.setNext(function(){this.exp&&this.exp.focus(),this.expMonth&&this.expMonth.focus()}.bind(this)),this.exp&&this.exp.setNext(function(){this.cvc&&this.cvc.focus()}.bind(this)),void n(this)}.bind(this);this.number=new e.CardField(this.instance,this,new e.CardFieldOptions(e.CardField.number).apply(t),this.element.querySelector("[data-processout-input=cc-number]"),function(){o=!0,c()},i);var u=this.element.querySelector("[data-processout-input=cc-cvc]");u?this.cvc=new e.CardField(this.instance,this,new e.CardFieldOptions(e.CardField.cvc).apply(t),u,function(){r=!0,c()},i):r=!0;var p=this.element.querySelector("[data-processout-input=cc-exp]");return p?this.exp=new e.CardField(this.instance,this,new e.CardFieldOptions(e.CardField.expiry).apply(t),p,function(){a=!0,s=!0,c()},i):(this.expMonth=new e.CardField(this.instance,this,new e.CardFieldOptions(e.CardField.expiryMonth).apply(t),this.element.querySelector("[data-processout-input=cc-exp-month]"),function(){a=!0,c()},i),this.expYear=new e.CardField(this.instance,this,new e.CardFieldOptions(e.CardField.expiryYear).apply(t),this.element.querySelector("[data-processout-input=cc-exp-year]"),function(){s=!0,c()},i)),this},t.prototype.setupCVC=function(t,n,i){return this.isRefreshCVC=!0,this.cvc=new e.CardField(this.instance,this,new e.CardFieldOptions(e.CardField.cvc).apply(t),this.element.querySelector("[data-processout-input=cc-cvc]"),function(){n(this)}.bind(this),i),this},t.prototype.getElement=function(){return this.element},t.prototype.addEventListener=function(e,t,n){return this.element.addEventListener(e,t,n)},t.prototype.on=function(e,t,n){return this.element.addEventListener(e,t,n)},t.prototype.getNumberField=function(){return this.number},t.prototype.getCVCField=function(){return this.cvc},t.prototype.getExpiryField=function(){return this.exp},t.prototype.getExpiryMonthField=function(){return this.expMonth},t.prototype.getExpiryYearField=function(){return this.expYear},t.prototype.validate=function(e,t){if(this.isRefreshCVC)this.cvc.validate(function(){e()},t);else{var n=!1,i=!1,o=!1,r=!1,a=function(){n&&i&&o&&r&&e()};this.number.validate(function(){n=!0,a()},t),this.cvc?this.cvc.validate(function(){i=!0,a()},t):i=!0,this.exp?this.exp.validate(function(){o=!0,r=!0,a()},t):(this.expMonth.validate(function(){o=!0,a()},t),this.expYear.validate(function(){r=!0,a()},t))}},t.prototype.tokenize=function(e,t,n){var i=["number"];this.cvc&&i.push("cvc"),this.exp&&i.push("exp"),this.expMonth&&i.push("exp-month"),this.expYear&&i.push("exp-year"),this.number.tokenize(i,e,t,n)},t.prototype.refreshCVC=function(t,n,i){this.cvc||i(new e.Exception("processout-js.wrong-type-for-action","RefreshCVC was called but the form has no CVC field initialized.")),this.cvc.refreshCVC(t,n,i)},t}();e.CardForm=t}(ProcessOut||(ProcessOut={})),function(e){var t={en:{default:"An error occured: your payment was declined.","card.declined":"The credit card has been declined.","card.expired":"The given card has expired.","card.duplicate":"The payment could not be completed. Please try again later.","card.network-failed":"The payment could not be completed. Please try again later.","card.invalid":"The given card is invalid.","card.invalid-name":"The cardholder name is invalid.","card.invalid-number":"The card number is invalid.","card.invalid-date":"The card expiry date is invalid.","card.invalid-month":"The card expiry month is invalid.","card.invalid-year":"The card expiry year is invalid.","card.invalid-cvc":"The card CVC is invalid.","card.invalid-zip":"The card's ZIP code is valid.","card.failed-cvc-and-avs":"The CVC and AVS code were invalid.","card.failed-three-d-s":"The 3D-Secure authentication failed.","card.bad-track-data":"The card could not be verified. Maybe your CVC is invalid?","card.not-registered":"The card is not registered.","card.issuer-not-found":"The card issuer could not be found. Please try another card.","card.possible-fraud":"The payment could not be completed. Please contact your bank for further help.","card.contact-bank":"The payment could not be completed. Please contact your bank for further help.","card.not-authorized":"The payment could not be authorized using the provided card.","card.do-not-honor":"The payment could not be completed. Please contact your bank for further help.","card.maximum-attempts":"The card maximum attempts has been reached and the payment could not be processed.","card.stolen":"The payment could not be processed as the provided card was marked as stolen.","card.lost":"The payment could not be processed as the provided card was marked as lost.","card.exceeded-limits":"The payment could not be processed as the payment limits of the card have been exceeded.","card.no-money":"There doesn't seem to be enough money on the bank account linked to the provided card.","customer.canceled":"The customer canceled the payment.","customer.popup-blocked":"Please allow pop-ups to continue with your payment flow.","gateway.declined":"The payment was declined.","payment.declined":"The payment was declined.","payment.pending":"The payment is currently pending, please wait a few minutes for it to fully go through.","three-d-s-2.fingerprint-timed-out":"The 3-D Secure fingerprinting timed out.","request.validation.error":"The provided information is invalid or missing.","request.validation.invalid-country":"The provided country is invalid.","request.validation.missing-name":"A name must be provided.","request.validation.invalid-name":"The provided name is invalid.","request.validation.missing-email":"An email must be provided.","request.validation.invalid-email":"The provided email is invalid.","request.validation.invalid-address":"The provided address is invalid.","request.validation.no-method-selected":"Please select a payment method.","request.gateway.not-available":"The requested gateway is currently unavailable.","request.gateway.not-supported":"The gateway is not supported by ProcessOut.js","processout-js.missing-project-id":"Your project ID was not specified when loading ProcessOut.js.","processout-js.not-hosted":"ProcessOut.js was not loaded from ProcessOut CDN. Please do not host ProcessOut.js yourself but rather use ProcessOut CDN: https://js.processout.com/processout.js","processout-js.modal.unavailable":"The ProcessOut.js modal is unavailable.","processout-js.field.unavailable":"The ProcessOut.js credit card field is unavailable.","processout-js.invalid-config":"The provided gateway configuration is invalid.","processout-js.no-customer-action":"No customer action is required for the given gateway configuration and resource.","processout-js.customer-action-not-supported":"The requested customer action is not supported by ProcessOut.js.","processout-js.invalid-field":"The given HTML element may not be used by ProcessOut.js: it is an input. Please only use divs when creating a ProcessOut.js credit card field.","processout-js.undefined-field":"The given HTML element was undefined.","processout-js.invalid-field-type":"The given field type was incorrect. It must either be number, expiry, expiryMonth, expiryYear or CVC.","processout-js.network-issue":"There seems to be some connectivity issue preventing the payment from making it through. Please switch to another network or try again in a few minutes.","processout-js.invalid-type":"The specified parameter had an unknown type.","processout-js.missing-source":"A source must be specified.","processout-js.wrong-type-for-action":"The requested action could not be performed on the given field because its type is invalid.","processout-js.missing-invoice-id":"An invoice ID must be specified.","processout-js.missing-resource-id":"A resource ID must be specified.","resource.invalid-type":"The provided resource was invalid. It must be an invoice, a subscription or an authorization request.","applepay.not-supported":"The current browser/device does not support Apple Pay.","applepay.no-success-handler":"A success handler must be specified when setting up Apple Pay.","applepay.not-available":"Apple Pay is not available for the current browser, device or ProcessOut project."},fr:{default:"Une erreur est survenue lors du paiement."}},n={en:{"label.cancel":"Cancel","label.apm-description":"A new window was opened to process your payment. Click here to continue."},fr:{"label.cancel":"Annuler","label.apm-description":"Une nouvelle fen&ecirc;tre s'est ouverte pour proc&eacute;der au paiement. Cliquez ici pour continuer."}},i=function(){function e(){}return e.getTranslated=function(e,t,n){return e[this.getLocale()]&&e[this.getLocale()][t]?e[this.getLocale()][t]:e.en[t]?e.en[t]:n||(e[this.getLocale()]&&e[this.getLocale()].default?e[this.getLocale()].default:t)},e.translateError=function(e,n){return this.getTranslated(t,e,n)},e.translateMessage=function(e,t){return this.getTranslated(n,e,t)},e.getLocale=function(){var e=navigator.language||navigator.userLanguage;return e.length<2?"en":e.substring(0,2).toLowerCase()},e}();e.Translator=i}(ProcessOut||(ProcessOut={})),function(e){var t=function(t){function n(n,i){var o=this;return i||(i=e.Translator.translateError(n)),(o=t.call(this,i)||this).code=n,o.message=i,o.name="ProcessOutException",o.stack=(new Error).stack,o}return __extends(n,t),n}(Error);e.Exception=t}(ProcessOut||(ProcessOut={})),function(e){e.DEBUG=!1,e.TestModePrefix="test-";var t=function(){function t(t,n){this.timeout=1e4,this.sandbox=!1,this.host="processout.com",this.processOutFieldEndpoint="",this.apiVersion="1.3.0.0";var i=document.getElementsByTagName("script"),o="";if(/^https?:\/\/.*\.processout\.((com)|(ninja)|(dev))\//.test(window.location.href))o=window.location.href;else for(var r=0;r<i.length;r++)/^https?:\/\/.*\.processout\.((com)|(ninja)|(dev))\//.test(i[r].getAttribute("src"))&&(o=i[r].getAttribute("src"));if(""==o&&!e.DEBUG)throw new e.Exception("processout-js.not-hosted");if(/^https?:\/\/.*\.processout\.ninja\//.test(o)?this.host="processout.ninja":/^https?:\/\/.*\.processout\.dev\//.test(o)?this.host="processout.dev":this.host="processout.com",!t)throw new e.Exception("processout-js.missing-project-id");if(this.projectID=t,0===this.projectID.lastIndexOf(e.TestModePrefix,0)&&(this.sandbox=!0),this.resourceID=n,this.resourceID&&""!=this.resourceID&&"iv_"!=this.resourceID.substring(0,3)&&"sub_"!=this.resourceID.substring(0,4)&&"auth_req_"!=this.resourceID.substring(0,9))throw new e.Exception("resource.invalid-type");this.applePay=new e.ApplePayWrapper(this),this.threeDS=new e.ThreeDSWrapper(this)}return t.prototype.getResourceID=function(){return this.resourceID},t.prototype.getProjectID=function(){return this.projectID},t.prototype.getProcessOutFieldEndpoint=function(t){var n=this.endpoint("js","/ccfield.html");return e.DEBUG&&this.processOutFieldEndpoint&&(n=this.processOutFieldEndpoint),""+n+t},t.prototype.setProcessOutFieldEndpoint=function(t){e.DEBUG&&(this.processOutFieldEndpoint=t)},t.prototype.endpoint=function(e,t){return"https://"+e+"."+this.host+t},t.prototype.apiRequest=function(e,t,n,i,o,r){r||(r=0),e=e.toLowerCase(),"http"!=t.substring(0,4)&&"/"!=t[0]&&(t=this.endpoint("api","/"+t));var a={"Content-Type":"application/json","API-Version":this.apiVersion};for(var s in this.projectID&&(a.Authorization="Basic "+btoa(this.projectID+":")),n||(n={}),n.idempotency_key&&(a["Idempotency-Key"]=n.idempotency_key,delete n.idempotency_key),t+="?legacyrequest=true&project_id="+this.projectID,a)t+="&x-"+s+"="+a[s];if("get"==e)for(var c in n)t+="&"+c+"="+encodeURIComponent(n[c]);var u=new XMLHttpRequest;if(window.XDomainRequest&&(u=new XDomainRequest),u.open(e,t,!0),!window.XDomainRequest)for(var s in a)u.setRequestHeader(s,a[s]);u.timeout=0,u.onload=function(e){var t;try{t=JSON.parse(u.responseText)}catch(e){t={}}window.XDomainRequest?i(t,u,e):4==e.currentTarget.readyState&&i(t,u,e)},u.onerror=function(e){u.status&&u.status>=200&&u.status<500&&u.responseText?u.onload(e):o(u,e)},u.ontimeout=function(){},u.onprogress=function(){},u.onabort=function(){r>3?o(u,null):this.request(e,t,n,i,o,r+1)}.bind(this),u.send(JSON.stringify(n))},t.prototype.setupForm=function(t,n,i,o){if(!this.projectID)throw new e.Exception("default","You must instanciate ProcessOut.js with a valid project ID in order to use ProcessOut's hosted forms.");if(!t)throw new e.Exception("default","The provided form element wasn't set. Make sure to provide setupForm with a valid form element.");return"function"==typeof n?new e.CardForm(this,t).setup(new e.CardFieldOptions(""),n,i):new e.CardForm(this,t).setup(n,i,o)},t.prototype.tokenize=function(t,n,i,o){if(t instanceof e.Card)return this.tokenizeCard(t,n,i,o);if(t instanceof e.CardForm)return this.tokenizeForm(t,n,i,o);if(t instanceof e.ApplePay)return t.tokenize(n,i,o);throw new e.Exception("processout-js.invalid-type","The first parameter had an unknown type/instance. The value must be an instance of either Card, CardForm or ApplePay.")},t.prototype.tokenizeCard=function(t,n,i,o){var r=t.validate();if(r)o(r);else{n||(n={}),n.contact||(n.contact={}),n.number=t.getNumber(),n.exp_month=t.getExpiry().getMonth().toString(),n.exp_year=t.getExpiry().getYear().toString(),n.cvc2=t.getCVC(),screen.colorDepth&&(n.app_color_depth=Number(screen.colorDepth));var a=navigator.language||navigator.userLanguage;a&&(n.app_language=a),screen.height&&(n.app_screen_height=screen.height),screen.width&&(n.app_screen_width=screen.width),n.time_zone_offset=Number((new Date).getTimezoneOffset()),window.navigator&&(n.app_java_enabled=window.navigator.javaEnabled()),this.apiRequest("post","cards",n,function(t,n,r){t.success?i(t.card.id):o(new e.Exception(t.error_type,t.message))},function(t,n){o(new e.Exception("processout-js.network-issue"))})}},t.prototype.tokenizeForm=function(e,t,n,i){e.validate(function(){e.tokenize(t,n,i)}.bind(this),i)},t.prototype.setupFormCVC=function(t,n,i,o){return"function"==typeof n?new e.CardForm(this,t).setupCVC(new e.CardFieldOptions(""),n,i):new e.CardForm(this,t).setupCVC(n,i,o)},t.prototype.refreshCVC=function(t,n,i,o){return n instanceof e.CardForm?this.refreshCVCForm(t,n,i,o):this.refreshCVCString(t,n,i,o)},t.prototype.refreshCVCForm=function(e,t,n,i){t.validate(function(){t.refreshCVC(e,n,i)}.bind(this),i)},t.prototype.refreshCVCString=function(t,n,i,o){var r=e.Card.validateCVC(n);r?o(r):this.apiRequest("put","cards/"+t,{cvc:n},function(t,n,r){t.success?i(t.card.id):o(new e.Exception("card.invalid"))},function(t,n){o(new e.Exception("processout-js.network-issue"))})},t.prototype.newModal=function(t,n,i){var o="";if("object"==typeof t&&(o=t.url,n=t.onReady,i=t.onError,!o&&(o=this.endpoint("checkout","/"+this.getProjectID()+"/oneoff?amount="+encodeURIComponent(t.amount)+"&currency="+encodeURIComponent(t.currency)+"&name="+encodeURIComponent(t.name)),t.metadata&&"object"==typeof t.metadata)))for(var r in t.metadata)t.metadata.hasOwnProperty(r)&&(o+="&metadata["+r+"]="+encodeURIComponent(t.metadata[r]));var a=Math.random().toString(36).substr(2,9),s=document.createElement("iframe");s.className="processout-iframe",s.setAttribute("id","processout-iframe-"+a),s.setAttribute("src",o),s.setAttribute("style","position: fixed; top: 0; left: 0; background: none; z-index: 9999999;"),s.setAttribute("frameborder","0"),s.setAttribute("allowtransparency","1"),s.style.display="none";var c=setTimeout(function(){typeof i==typeof Function&&i(new e.Exception("processout-js.modal.unavailable"))},this.timeout);s.onload=function(){clearTimeout(c),typeof n==typeof Function&&n(new e.Modal(this,s,a))}.bind(this),document.body.appendChild(s)},t.prototype.fetchGatewayConfigurations=function(t,n,i){if(t||(t={}),!t.invoiceID&&!t.customerID!=!t.tokenID)throw new e.Exception("processout-js.missing-resource-id");this.apiRequest("GET","gateway-configurations",{filter:t.filter,expand_merchant_accounts:"true"},function(o){if(o.success){for(var r=[],a=0,s=o.gateway_configurations;a<s.length;a++){var c=s[a];c.handleInvoiceAction=this.buildHandleInvoiceAction(t.invoiceID,c),c.hookForInvoice=this.buildConfHookForInvoice(c),c.handleCustomerTokenAction=this.buildHandleCustomerTokenAction(t.customerID,t.tokenID,c),c.hookForCustomerToken=this.buildConfHookForCustomerToken(c),r.push(c)}n(r)}else i(new e.Exception(o.error_type,o.message))}.bind(this),function(t,n){i(new e.Exception("processout-js.network-issue"))})},t.prototype.handleInvoiceAction=function(t,n,i,o){var r=n,a=null,s=null;n&&n.id&&(r=n.id,n.gateway&&(a=n.gateway.name,s=n.gateway.logo_url));var c=new e.ActionHandlerOptions(a,s),u=this.endpoint("checkout","/"+this.getProjectID()+"/"+t+"/redirect/"+r);return this.handleAction(u,i,o,c)},t.prototype.buildHandleInvoiceAction=function(e,t){return function(n,i){return this.handleInvoiceAction(e,t,n,i)}.bind(this)},t.prototype.buildConfHookForInvoice=function(e){return function(t,n,i){t.addEventListener("click",function(t){return t.preventDefault(),e.handleInvoiceAction(n,i),!1}.bind(this))}.bind(this)},t.prototype.handleCustomerTokenAction=function(t,n,i,o,r){var a=i,s=null,c=null;i&&i.id&&(a=i.id,i.gateway&&(s=i.gateway.name,c=i.gateway.logo_url));var u=new e.ActionHandlerOptions(s,c),p=this.endpoint("checkout","/"+this.getProjectID()+"/"+t+"/"+n+"/redirect/"+a);return this.handleAction(p,o,r,u)},t.prototype.buildHandleCustomerTokenAction=function(e,t,n){return function(i,o){return this.handleCustomerTokenAction(e,t,n,i,o)}.bind(this)},t.prototype.buildConfHookForCustomerToken=function(e){return function(t,n,i){t.addEventListener("click",function(t){return t.preventDefault(),e.handleCustomerTokenAction(n,i),!1}.bind(this))}.bind(this)},t.prototype.handleAction=function(t,n,i,o){return new e.ActionHandler(this,o).handle(t,n,i)},t.prototype.makeCardPayment=function(t,n,i,o,r){i||(i={});var a=n;i.gatewayRequestSource&&(a=i.gatewayRequestSource);var s={authorize_only:i.authorize_only,capture_amount:i.capture_amount,auto_capture_at:i.auto_capture_at,source:a,enable_three_d_s_2:!0};i.idempotency_key&&(i.iterationNumber||(i.iterationNumber=1),s.idempotency_key=i.idempotency_key+"-"+i.iterationNumber,i.iterationNumber++),this.apiRequest("POST","invoices/"+t+"/capture",s,function(a){if(a.success)if(a.customer_action){var s=function(e){i.gatewayRequestSource=e,this.makeCardPayment(t,n,i,o,r)}.bind(this);switch(a.customer_action.type){case"url":this.handleAction(a.customer_action.value,function(e){i.gatewayRequestSource=null,this.makeCardPayment(t,n,i,o,r)}.bind(this),r,new e.ActionHandlerOptions(e.ActionHandlerOptions.ThreeDSChallengeFlow));break;case"fingerprint":this.handleAction(a.customer_action.value,s,r,new e.ActionHandlerOptions(e.ActionHandlerOptions.ThreeDSFingerprintFlow));break;case"redirect":this.handleAction(a.customer_action.value,s,r,new e.ActionHandlerOptions(e.ActionHandlerOptions.ThreeDSChallengeFlow));break;default:r(new e.Exception("processout-js.wrong-type-for-action","The customer action type "+a.customer_action.type+" is not supported."))}}else o(t);else r(new e.Exception(a.error_type,a.message))}.bind(this),function(t,n){r(new e.Exception("processout-js.network-issue"))})},t}();e.ProcessOut=t}(ProcessOut||(ProcessOut={})),function(e){var t=function(){function t(e,t,n){this.deleted=!1,this.timeout=1e4,this.instance=e,this.iframe=t,this.uniqId=n}return t.prototype.show=function(t,n,i){var o,r,a,s=t;"object"==typeof t&&(s=t.onShow,n=t.onHide,i=t.onError,o=t.onPayment,r=t.onPaymentError,a=t.hideAfterSuccessTimeout),null==a&&(a=2500);var c=this,u=c.iframe,p=u.contentWindow,d=c.uniqId;p.postMessage(JSON.stringify({namespace:e.Message.modalNamespace,frameID:d,action:"check"}),"*");var l=setTimeout(function(){typeof i==typeof Function&&i(c,new e.Exception("processout-js.modal.unavailable"))},this.timeout);window.addEventListener("message",function(t){var h=e.Message.parseEvent(t);if(h.frameID==d&&h.namespace==e.Message.modalNamespace)switch(h.action){case"openModal":if(clearTimeout(l),document.body.style.overflow="hidden",window.addEventListener("resize",function(e){u.width=window.outerWidth+"px",u.height=window.outerHeight+"px"}),"function"==typeof Event)var f=new Event("resize");else{f=document.createEvent("Event");t.initEvent("resize",!0,!0)}window.dispatchEvent(f),u.style.display="block",p.postMessage(JSON.stringify({namespace:e.Message.modalNamespace,frameID:d,action:"launch"}),"*"),typeof s==typeof Function&&s(c);break;case"closeModal":c.hide(),typeof n==typeof Function&&n(c);break;case"error":clearTimeout(l),typeof i==typeof Function&&i(c,new e.Exception(h.errorCode,h.errorMessage));break;case"onPayment":typeof o==typeof Function&&o(c,h.data),a>0&&setTimeout(function(){c.hide()},a);break;case"onPaymentError":typeof r==typeof Function&&r(c,new e.Exception(h.errorCode,h.errorMessage));break;default:console.log("Could not read event action from modal.",t.data)}},!1)},t.prototype.hide=function(){this.iframe.style.display="none",document.body.style.overflow="",this.iframe.remove(),this.deleted=!0},t.prototype.isDeleted=function(){return this.deleted},t}();e.Modal=t}(ProcessOut||(ProcessOut={})),function(e){var t=function(){function e(){}return e.parseEvent=function(t){try{return JSON.parse(t.data)}catch(t){return new e}},e.modalNamespace="processout.modal",e.checkoutNamespace="processout.checkout",e.fieldNamespace="processout.field",e}();e.Message=t}(ProcessOut||(ProcessOut={})),function(e){var t,n=function(){function e(e,t){if(this.element=e,this.iframe=t,window.addEventListener("resize",function(e){var t=Math.max(window.outerWidth,window.innerWidth);this.element.style.width=t+"px";var n=Math.max(document.body.scrollHeight,document.body.offsetHeight,document.documentElement.clientHeight,document.documentElement.scrollHeight,document.documentElement.offsetHeight);this.element.style.height=n+"px"}.bind(this)),"function"==typeof Event)var n=new Event("resize");else(n=document.createEvent("Event")).initEvent("resize",!0,!0);window.dispatchEvent(n)}return e.prototype.open=function(e){this.iframe.setAttribute("src",e),document.body.style.overflow="hidden",document.body.appendChild(this.element)},e.prototype.close=function(){document.body.style.overflow="",this.closed=!0,this.element.remove()},e}();!function(e){e[e.NewTab=0]="NewTab",e[e.NewWindow=1]="NewWindow",e[e.IFrame=2]="IFrame",e[e.FingerprintIframe=3]="FingerprintIframe"}(t=e.ActionFlow||(e.ActionFlow={}));var i=function(){function e(n,i){switch(this.gatewayLogo=i,n){case e.ThreeDSChallengeFlow:this.flow=t.IFrame;break;case e.ThreeDSFingerprintFlow:this.flow=t.FingerprintIframe;break;case"paypal":case"paypalexpresscheckout":this.flow=t.NewWindow,this.newWindowHeight=645,this.newWindowWidth=450;break;case"test-credit-card":case"test-alternative-payment":this.flow=t.NewWindow,this.newWindowHeight=645,this.newWindowWidth=450;break;default:this.flow=t.NewTab}this.flow==t.NewWindow&&/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&(this.flow=t.NewTab)}return e.ThreeDSChallengeFlow="three-d-s-challenge-flow",e.ThreeDSFingerprintFlow="three-d-s-fingerprint-flow",e}();e.ActionHandlerOptions=i;var o=function(){function o(o,r){if(this.canceled=!1,this.instance=o,this.options=r,this.options||(this.options=new i),this.options.flow==t.IFrame){var a=document.createElement("div");a.id="processoutjs-action-modal",a.style.position="fixed",a.style.top="0",a.style.left="0",a.style.height="100%",a.style.width="100%",a.setAttribute("style","position: fixed; top: 0; left: 0; background: rgba(0, 0, 0, 0.5); z-index: 9999999; overflow: auto;");var s=document.createElement("iframe");s.setAttribute("style",'margin: 1em auto; width: 440px; height: 480px; max-width: 100%; max-height: 100%; display: block; box-shadow: 0 15px 35px rgba(50, 50, 93, 0.1), 0 5px 15px rgba(0, 0, 0, 0.07); background-color: #ECEFF1; background-image: url("'+this.instance.endpoint("js","/images/loader.gif")+'"); background-repeat: no-repeat; background-position: center;")'),s.setAttribute("frameborder","0");var c=document.createElement("div");c.setAttribute("style","width: 100%; text-align: center; margin-bottom: 1em;");var u=document.createElement("div");u.setAttribute("style","cursor: pointer; color: white;"),u.innerHTML=e.Translator.translateMessage("label.cancel","Cancel"),c.appendChild(u),a.appendChild(s),a.appendChild(c),this.iframeWrapper=new n(a,s),u.onclick=function(){this.iframeWrapper.close()}.bind(this)}}return o.prototype.handle=function(n,i,o){var r,a,s,c,u,p=this,d=function(){c&&c.remove(),window.focus()};switch(this.options.flow){case t.NewWindow:r=this.createNewWindow(n),c=r.topLayer,u=r.newWindow;break;case t.IFrame:(u=this.iframeWrapper).open(n);break;case t.FingerprintIframe:(u=this.createFingerprintIFrame()).open(n),s=setTimeout(function(){o(new e.Exception("three-d-s-2.fingerprint-timed-out"))},1e4);break;default:a=this.createNewTab(n),c=a.topLayer,u=a.newWindow}if(!u)return o(new e.Exception("customer.popup-blocked")),d(),null;var l=setInterval(function(){if(l){if(p.isCanceled())return clearInterval(l),l=null,u.close(),o(new e.Exception("customer.canceled")),void d();var t=function(){clearInterval(l),l=null,o(new e.Exception("customer.canceled")),d()};try{u&&!u.closed||t()}catch(e){try{u.close()}catch(e){}t()}}});return this.listenEvents(u,l,d,function(e){s&&clearTimeout(s),i(e)},function(e){s&&clearTimeout(s),o(e)}),this},o.prototype.createNewTab=function(e){var t=window.open(e,"_blank");return this.setupWindowObject(t)},o.prototype.createNewWindow=function(e){var t=this.options.newWindowHeight,n=this.options.newWindowWidth,i=window.top.outerHeight/2+window.top.screenY-t/2,o=window.top.outerWidth/2+window.top.screenX-n/2,r=window.open(e,"","menubar=false,toolbar=false,width="+n+",height="+t+",top="+i+",left="+o);return this.setupWindowObject(r)},o.prototype.setupWindowObject=function(t){if(!t)return{};var n={topLayer:null,newWindow:t},i=function(e){try{n.newWindow.close()}catch(e){}};window.addEventListener("beforeunload",i,!1),window.addEventListener("pagehide",i,!1);var o=setInterval(function(){n.newWindow&&!n.newWindow.closed||clearInterval(o);try{n.newWindow.postMessage("processout.ping-ready","*")}catch(e){}},250);n.topLayer=document.createElement("div"),n.topLayer.id="processoutjs-action-modal",n.topLayer.setAttribute("style","position: fixed; top: 0; left: 0; background: rgba(0, 0, 0, 0.7); z-index: 9999999; overflow: auto; height: 100%; width: 100%;");var r=document.createElement("div");if(r.setAttribute("style","text-align: center; color: white; max-width: 350px; margin: 0 auto; margin-top: 10%; cursor: pointer;"),this.options.gatewayLogo){var a=document.createElement("img");a.setAttribute("style","max-height: 70px; max-width: 230px; filter: brightness(0) invert(1); margin-bottom: 2em;"),a.setAttribute("src",this.options.gatewayLogo),r.appendChild(a)}var s=document.createElement("div");return s.innerHTML=e.Translator.translateMessage("label.apm-description"),r.appendChild(s),n.topLayer.appendChild(r),r.addEventListener("click",function(){n.newWindow.focus()},!1),document.body.appendChild(n.topLayer),n},o.prototype.createFingerprintIFrame=function(){var e=document.createElement("div");e.id="processoutjs-fingerprint-wrapper",e.style.height="0",e.style.width="0";var t=document.createElement("iframe");return t.style.display="none",t.setAttribute("frameborder","0"),e.appendChild(t),new n(e,t)},o.prototype.listenEvents=function(t,n,i,r,a){o.listenerCount++;var s=o.listenerCount,c=!1;window.addEventListener("message",function(u){var p=e.Message.parseEvent(u);if(p.namespace==e.Message.checkoutNamespace)if(o.listenerCount==s){if(!c)switch(c=!0,p.action){case"success":n&&(clearInterval(n),n=null),t.close(),r(p.data),i();break;case"canceled":n&&(clearInterval(n),n=null),t.close(),a(new e.Exception("customer.canceled")),i();break;case"none":n&&(clearInterval(n),n=null),t.close(),a(new e.Exception("processout-js.no-customer-action")),i();break;case"error":n&&(clearInterval(n),n=null),t.close(),a(new e.Exception(p.errorCode,p.errorMessage)),i();break;default:n&&(clearInterval(n),n=null),t.close(),a(new e.Exception("default")),i()}}else n&&(clearInterval(n),n=null)})},o.prototype.cancel=function(){this.canceled=!0},o.prototype.isCanceled=function(){return this.canceled},o.listenerCount=0,o}();e.ActionHandler=o}(ProcessOut||(ProcessOut={}));
